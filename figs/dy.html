<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="d3viz/css/d3viz.css"/>
	<link rel="stylesheet" href="d3viz/css/d3-context-menu.css"/>
	<script type="text/javascript" src="d3viz/js/d3viz.js"></script>
	<script type="text/javascript" src="d3viz/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/dagre-d3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/graphlib-dot.min.js"></script>
	<script type="text/javascript" src="d3viz/js/d3-context-menu.js"></script>
</head>
<body>
	<div id='menu' class='menuBar'>
	    <input name="resetNodes" 
	           type="button" 
	           value="Reset nodes"
	           onclick="resetNodes()"/>
	    <input name="releaseNodes" 
	           type="button" 
	           value="Release nodes"
	           onclick="releaseNodes()"/>
	</div>

	<script type="text/javascript">
		// Backend graph in DOT format
		var dotGraph = graphlibDot.read("digraph G {\n\tgraph [bb=\"0,0,431.14,552\"];\n\tnode [label=\"\\N\"];\n\tn1\t [apply_op=DimShuffle,\n\t\theight=0.5,\n\t\tlabel=DimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"123,448\",\n\t\tshape=ellipse,\n\t\twidth=1.4272];\n\tn8\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"140,362\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2494];\n\tn1 -> n8\t [label=\"1 bscalar\",\n\t\tlp=\"145.07,405\",\n\t\tpos=\"e,127.84,379.54 119.12,429.68 117.77,420.1 117.18,408.27 119.86,398 120.69,394.81 121.87,391.61 123.25,388.5\"];\n\tn2\t [dtype=bscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=1,\n\t\tnode_type=constant_input,\n\t\tpos=\"123,534\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn2 -> n1\t [color=dodgerblue,\n\t\tlabel=bscalar,\n\t\tlp=\"142.82,491\",\n\t\tpos=\"e,123,466.21 123,515.76 123,504.36 123,489.43 123,476.49\"];\n\tn4\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"248,362\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2494];\n\tn10\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"312,276\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2494];\n\tn4 -> n10\t [label=\"0 bscalar\",\n\t\tlp=\"293.07,319\",\n\t\tpos=\"e,289.02,291.78 253.23,343.79 256.66,333.8 261.83,321.54 268.86,312 272.42,307.17 276.76,302.58 281.3,298.4\"];\n\tn5\t [dtype=dscalar,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=x,\n\t\tnode_type=input,\n\t\tpos=\"27,448\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn5 -> n4\t [label=\"0 dscalar\",\n\t\tlp=\"213.07,405\",\n\t\tpos=\"e,222.35,376.91 54.161,433.37 57.095,432.11 60.077,430.95 63,430 108.85,415.05 125.63,430.9 170,412 179.6,407.91 180.2,403.83 188.86,\\\n398 196.77,392.67 205.45,387.19 213.67,382.16\"];\n\tn13\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"140,276\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2494];\n\tn5 -> n13\t [label=\"0 dscalar\",\n\t\tlp=\"61.071,362\",\n\t\tpos=\"e,106.8,288.33 23.977,429.63 21.335,407.63 20.056,370.44 35.858,344 49.815,320.65 75.262,303.81 97.506,292.73\"];\n\tn6\t [dtype=bscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=2,\n\t\tnode_type=constant_input,\n\t\tpos=\"338,448\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn6 -> n4\t [label=\"1 bscalar\",\n\t\tlp=\"350.07,405\",\n\t\tpos=\"e,281.44,374.24 333.2,429.67 329.77,419.39 324.27,406.89 316,398 308.9,390.37 299.82,384.05 290.62,378.95\"];\n\tn6 -> n8\t [label=\"0 bscalar\",\n\t\tlp=\"286.07,405\",\n\t\tpos=\"e,174.85,373.6 310.91,436.75 296.06,430.2 277.53,421.4 261.86,412 252.91,406.63 252.22,402.89 243,398 237.42,395.04 209.66,385.38 \\\n184.37,376.82\"];\n\tn15\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"312,190\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2494];\n\tn6 -> n15\t [label=\"1 bscalar\",\n\t\tlp=\"406.07,319\",\n\t\tpos=\"e,341.49,203.6 365,430.11 370.64,424.98 375.83,418.89 379,412 397.57,371.62 383.58,356.3 380,312 376.88,273.4 386.97,258.56 366,\\\n226 361.89,219.62 356.2,214.1 350.05,209.44\"];\n\tn8 -> n13\t [label=\"1 dscalar\",\n\t\tlp=\"165.07,319\",\n\t\tpos=\"e,140,294.21 140,343.76 140,332.36 140,317.43 140,304.49\"];\n\tn10 -> n15\t [label=\"0 dscalar\",\n\t\tlp=\"337.07,233\",\n\t\tpos=\"e,312,208.21 312,257.76 312,246.36 312,231.43 312,218.49\"];\n\tn11\t [dtype=dscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=\" 1.\",\n\t\tnode_type=constant_input,\n\t\tpos=\"338,362\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn11 -> n10\t [label=\"1 dscalar\",\n\t\tlp=\"351.07,319\",\n\t\tpos=\"e,317.42,293.92 332.49,343.76 328.98,332.17 324.37,316.93 320.42,303.84\"];\n\tn17\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"178,104\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2494];\n\tn13 -> n17\t [label=\"1 bscalar\",\n\t\tlp=\"187.07,190\",\n\t\tpos=\"e,174,122.1 143.99,257.92 150.61,227.98 163.88,167.9 171.75,132.3\"];\n\tn15 -> n17\t [label=\"0 bscalar\",\n\t\tlp=\"278.07,147\",\n\t\tpos=\"e,202.2,119.53 288.04,174.62 266.55,160.83 234.81,140.46 210.93,125.13\"];\n\tn18\t [dtype=dscalar,\n\t\tfillcolor=dodgerblue,\n\t\theight=0.5,\n\t\tlabel=dscalar,\n\t\tnode_type=output,\n\t\tpos=\"178,18\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.7728];\n\tn17 -> n18\t [label=dscalar,\n\t\tlp=\"197.82,61\",\n\t\tpos=\"e,178,36.212 178,85.762 178,74.36 178,59.434 178,46.494\"];\n}\n");
		// Frontend graph for visualization
		var graph = {};
		
		var forceLayout;
		var isProfiled = false; // true if profiling information available
		var useProfileColors = false;
		var fixOnInit = true; // fix nodes on initialization
		var maxProfilePer = 0;
		var profileColors = ["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15"];
		var pad = 10;
		var isEditNode = false; // true if node is edited
		var menuItems = [
			{
				title: 'Edit',
				action: function(elm, d, i) { editNode(elm, d); }
			},
			{
				title: 'Release',
				action: function(elm, d, i) { releaseNode(d); }
			}
		];

		// Create main panel
		d3.select('body').select('svg').remove();
		var svg = d3.select('body').append('svg')
			.attr('width', '100%')
			.attr('height', '95%');
		var pane = svg.append('g');
		
		// Zoom behaviour
		var zoom = d3.behavior.zoom()
			.scaleExtent([0.2, 8])
			.on('zoom', function(d) {
				var trans = d3.event.translate;
				trans[0] += 300;
				trans[1] += 100;
				pane.attr('transform', 'translate(' + trans + ') scale(' + d3.event.scale + ')');
			});
		svg.call(zoom);
		zoom.event(svg);
		svg.on("dblclick.zoom", null);
		
		// Edges
		var edgeDiv = d3.select('body').append('div')
			.attr('class', 'edgeTooltip')
			.style('opacity', 0.0);
		
		// Div for node details	
		var nodeInfo = d3.select('body').append('div')
			.attr('class', 'nodeInfo')
			.style('opacity', 0.0);
		
		// Definition head of edges
		var markerData = [
			{'id': 'n', 'color': 'black'},
			{'id': 'r', 'color': 'red'},
			{'id': 'b', 'color': 'dodgerblue'}];
		svg.append("defs").selectAll('marker').data(markerData).enter().append("marker")
		    .attr("id", function(d) { return 'edgeArrow_' + d.id;})
		    .attr("markerWidth", 4)
		    .attr("markerHeight", 4)
		    .attr("refX", 2)
		    .attr("refY", 2)
		    .attr("orient", "auto")
		  	.append("path")
		    .attr("d", "M0,0 L4,2 L0,4 Z")
		    .attr('fill', function(d) { return d.color;});
	
		// Initialize graph
		processDotGraph(dotGraph);		
		graph = frontEndGraph(dotGraph);
		drawGraph();
	</script>
</body>
</html>
